<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>訂購系統</title>
  <style>
    /* 樣式保持不變，與上一版相同，此處省略以節省篇幅，請保留原有樣式 */
    /* 重要：務必保留 overflow: hidden 等設定 */
  </style>
</head>
<body>
  <div class="loading" id="loading">...</div>
  <div class="error-message" id="errorMessage">...</div>
  <div class="iframe-container" id="iframeContainer">
    <iframe
      id="orderSystemIframe"
      sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-modals allow-downloads"
      loading="lazy"
    ></iframe>
  </div>

  <script>
    const iframe      = document.getElementById("orderSystemIframe");
    const loading     = document.getElementById("loading");
    const container   = document.getElementById("iframeContainer");
    const errorBox    = document.getElementById("errorMessage");
    const errorText   = document.getElementById("errorText");
    const retryBtn    = document.getElementById("retryBtn");

    // 判斷父頁面的裝置類型 (同樣使用 userAgent)
    function isParentMobile() {
      return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    }

    // 組合 iframe 的 src，加上 force 參數
    const baseSrc = "https://script.google.com/macros/s/AKfycbwTjkjyQp-hL-owCzgh0quHcVR9jRaQ0WGLa-DN5V9NZXpcKs-FAnk3Y_AGmr1gmLOV/exec";
    const forceParam = isParentMobile() ? "?force=mobile" : "?force=desktop";
    iframe.src = baseSrc + forceParam;

    // 其餘載入、錯誤處理邏輯保持不變
    iframe.onload = () => {
      loading.classList.add("hidden");
      container.classList.add("show");
      setTimeout(() => loading.style.display = "none", 300);
    };

    iframe.onerror = () => {
      showError("無法載入訂購系統，請檢查網路連線");
    };

    const timeout = setTimeout(() => {
      if (!container.classList.contains("show")) {
        showError("載入逾時，請稍後再試");
      }
    }, 15000);

    function showError(msg) {
      loading.classList.add("hidden");
      errorText.textContent = msg;
      errorBox.classList.add("show");
      clearTimeout(timeout);
    }

    retryBtn.onclick = () => {
      errorBox.classList.remove("show");
      loading.style.display = "flex";
      loading.classList.remove("hidden");
      container.classList.remove("show");
      iframe.src = baseSrc + forceParam; // 重新載入，參數不變
    };
  </script>
</body>
</html>
